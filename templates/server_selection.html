<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord Bot Dashboard - Server Selection</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/server_selection.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- Server Selection Sidebar -->
        <div class="server-sidebar">
            <div class="user-profile">
                <div class="user-avatar">
                    <img src="{% if user.avatar %}https://cdn.discordapp.com/avatars/{{ user.id }}/{{ user.avatar }}.png{% else %}https://cdn.discordapp.com/embed/avatars/{{ (user.discriminator|int) % 5 }}.png{% endif %}" alt="User Avatar">
                </div>
                <div class="user-info">
                    <div class="username">{{ user.username }}#{{ user.discriminator or '0001' }}</div>
                    <div class="user-status">Online</div>
                </div>
            </div>
            
            <div class="server-list">
                <div class="server-section">
                    <h3>Your Servers ({{ guilds|length }})</h3>
                    <div class="server-grid">
                        {% for guild in guilds %}
                        <div class="server-circle" data-server-id="{{ guild.id }}" onclick="selectServer('{{ guild.id }}')">
                            {% if guild.icon %}
                                <img src="https://cdn.discordapp.com/icons/{{ guild.id }}/{{ guild.icon }}.png" alt="{{ guild.name }}">
                            {% else %}
                                <div class="server-letter">{{ guild.name[0] }}</div>
                            {% endif %}
                            <div class="server-tooltip">
                                {{ guild.name }}
                                {% if guild.bot_in_server %}
                                    <span class="bot-status online">‚úì Bot Added</span>
                                {% else %}
                                    <span class="bot-status offline">‚ö† Bot Not Added</span>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                        <div class="server-circle add-server" onclick="inviteBot()">
                            <span>+</span>
                            <div class="server-tooltip">Add Bot to Server</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-footer">
                <button class="logout-btn" onclick="window.location.href='/logout'">Logout</button>
            </div>
        </div>
        
        <!-- Main Content Area -->
        <div class="main-content">
            <div class="server-header">
                <div class="server-info">
                    <div class="server-icon">
                        <img src="https://cdn.discordapp.com/icons/server1/icon.png" alt="Server Icon">
                    </div>
                    <div class="server-details">
                        <h1>My Discord Server</h1>
                        <p>Bot Status: <span class="status-online">Online</span></p>
                    </div>
                </div>
                
                <div class="server-actions">
                    <button class="btn-secondary" onclick="changeBotAvatar()">Change Bot Avatar</button>
                    <button class="btn-danger" onclick="removeBot()">Remove Bot</button>
                </div>
            </div>
            
            <!-- Navigation Tabs -->
            <nav class="tab-navigation">
                <button class="tab-btn active" data-tab="dashboard">Dashboard</button>
                <button class="tab-btn" data-tab="music">Music</button>
                <button class="tab-btn" data-tab="moderation">Moderation</button>
                <button class="tab-btn" data-tab="minecraft">Minecraft</button>
                <button class="tab-btn" data-tab="settings">Settings</button>
            </nav>
            
            <!-- Tab Content -->
            <div class="tab-content">
                <!-- Enhanced Dashboard Tab -->
                <div class="tab-panel active" id="dashboard">
                    <!-- Quick Stats Overview -->
                    <div class="quick-stats">
                        <div class="quick-stat">
                            <div class="quick-stat-icon">üü¢</div>
                            <div class="quick-stat-content">
                                <div class="quick-stat-label">Bot Status</div>
                                <div class="quick-stat-value" id="quickBotStatus">Online</div>
                            </div>
                        </div>
                        <div class="quick-stat">
                            <div class="quick-stat-icon">üè†</div>
                            <div class="quick-stat-content">
                                <div class="quick-stat-label">Total Servers</div>
                                <div class="quick-stat-value" id="quickTotalServers">0</div>
                            </div>
                        </div>
                        <div class="quick-stat">
                            <div class="quick-stat-icon">üë•</div>
                            <div class="quick-stat-content">
                                <div class="quick-stat-label">Total Users</div>
                                <div class="quick-stat-value" id="quickTotalUsers">0</div>
                            </div>
                        </div>
                        <div class="quick-stat">
                            <div class="quick-stat-icon">‚ö°</div>
                            <div class="quick-stat-content">
                                <div class="quick-stat-label">Commands Today</div>
                                <div class="quick-stat-value" id="quickCommandsToday">0</div>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Gauge Cards -->
                    <div class="stats-grid">
                        <div class="stat-card primary enhanced-gauge">
                            <div class="stat-header">
                                <h3>‚ö° Minecraft Updates</h3>
                                <div class="trend-indicator positive" id="minecraftTrend">‚Üó +12%</div>
                            </div>
                            <div class="stat-content">
                                <div class="gauge-container">
                                    <canvas id="minecraftCounterGauge" width="150" height="150"></canvas>
                                    <div class="gauge-center">
                                        <div class="gauge-value" id="minecraftCounterValue">0</div>
                                        <div class="gauge-max" id="minecraftCounterMax">/1000</div>
                                    </div>
                                </div>
                                <div class="gauge-stats">
                                    <div class="gauge-stat">
                                        <span class="gauge-stat-label">Today</span>
                                        <span class="gauge-stat-value" id="minecraftToday">0</span>
                                    </div>
                                    <div class="gauge-stat">
                                        <span class="gauge-stat-label">Peak Hour</span>
                                        <span class="gauge-stat-value" id="minecraftPeak">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card secondary enhanced-gauge">
                            <div class="stat-header">
                                <h3>üìä Command Usage</h3>
                                <div class="trend-indicator positive" id="commandTrend">‚Üó +8%</div>
                            </div>
                            <div class="stat-content">
                                <div class="gauge-container">
                                    <canvas id="botUsageGauge" width="150" height="150"></canvas>
                                    <div class="gauge-center">
                                        <div class="gauge-value" id="botUsageValue">0</div>
                                        <div class="gauge-max" id="botUsageMax">/500</div>
                                    </div>
                                </div>
                                <div class="gauge-stats">
                                    <div class="gauge-stat">
                                        <span class="gauge-stat-label">This Hour</span>
                                        <span class="gauge-stat-value" id="commandsHour">0</span>
                                    </div>
                                    <div class="gauge-stat">
                                        <span class="gauge-stat-label">Most Used</span>
                                        <span class="gauge-stat-value" id="topCommand">play</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card success enhanced-gauge">
                            <div class="stat-header">
                                <h3>‚è±Ô∏è System Uptime</h3>
                                <div class="trend-indicator stable" id="uptimeTrend">‚Üí 99.9%</div>
                            </div>
                            <div class="stat-content">
                                <div class="gauge-container">
                                    <canvas id="uptimeGauge" width="150" height="150"></canvas>
                                    <div class="gauge-center">
                                        <div class="gauge-value" id="uptimeValue">0%</div>
                                        <div class="gauge-max">uptime</div>
                                    </div>
                                </div>
                                <div class="gauge-stats">
                                    <div class="gauge-stat">
                                        <span class="gauge-stat-label">Session</span>
                                        <span class="gauge-stat-value" id="sessionTime">0h</span>
                                    </div>
                                    <div class="gauge-stat">
                                        <span class="gauge-stat-label">Last Restart</span>
                                        <span class="gauge-stat-value" id="lastRestart">Never</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card warning enhanced-gauge">
                            <div class="stat-header">
                                <h3>üéÆ Active Players</h3>
                                <div class="trend-indicator positive" id="playerTrend">‚Üó +5</div>
                            </div>
                            <div class="stat-content">
                                <div class="gauge-container">
                                    <canvas id="playersGauge" width="150" height="150"></canvas>
                                    <div class="gauge-center">
                                        <div class="gauge-value" id="playersValue">0</div>
                                        <div class="gauge-max" id="playersMax">/100</div>
                                    </div>
                                </div>
                                <div class="gauge-stats">
                                    <div class="gauge-stat">
                                        <span class="gauge-stat-label">Peak Today</span>
                                        <span class="gauge-stat-value" id="peakPlayers">0</span>
                                    </div>
                                    <div class="gauge-stat">
                                        <span class="gauge-stat-label">Avg/Day</span>
                                        <span class="gauge-stat-value" id="avgPlayers">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Chart Section -->
                    <div class="chart-section">
                        <!-- Command Usage Chart -->
                        <div class="chart-card">
                            <div class="stat-header">
                                <h3>üìà Command Usage Breakdown</h3>
                                <div class="chart-controls">
                                    <select id="commandPeriod" onchange="updateCommandChart()">
                                        <option value="today">Today</option>
                                        <option value="week">This Week</option>
                                        <option value="month">This Month</option>
                                    </select>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="commandUsageChart"></canvas>
                            </div>
                        </div>

                        <!-- Activity Timeline Chart -->
                        <div class="chart-card">
                            <div class="stat-header">
                                <h3>üìä Activity Timeline (24h)</h3>
                                <div class="chart-controls">
                                    <button class="chart-btn active" onclick="setActivityView('hourly')">Hourly</button>
                                    <button class="chart-btn" onclick="setActivityView('daily')">Daily</button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="activityTimelineChart"></canvas>
                            </div>
                        </div>

                        <!-- Minecraft Server Status Dashboard -->
                        <div class="chart-card wide">
                            <div class="stat-header">
                                <h3>üéÆ Minecraft Server Dashboard</h3>
                                <div class="chart-controls">
                                    <button class="chart-btn" onclick="refreshMinecraftData()">Refresh</button>
                                    <button class="chart-btn" onclick="exportMinecraftData()">Export</button>
                                </div>
                            </div>
                            <div class="minecraft-dashboard">
                                <div class="minecraft-chart-section">
                                    <canvas id="minecraftHistoryChart"></canvas>
                                </div>
                                <div class="minecraft-stats-grid">
                                    <div class="minecraft-stat">
                                        <div class="minecraft-stat-icon">üè†</div>
                                        <div class="minecraft-stat-content">
                                            <div class="minecraft-stat-value" id="totalServers">0</div>
                                            <div class="minecraft-stat-label">Servers</div>
                                        </div>
                                    </div>
                                    <div class="minecraft-stat">
                                        <div class="minecraft-stat-icon">üü¢</div>
                                        <div class="minecraft-stat-content">
                                            <div class="minecraft-stat-value" id="onlineServers">0</div>
                                            <div class="minecraft-stat-label">Online</div>
                                        </div>
                                    </div>
                                    <div class="minecraft-stat">
                                        <div class="minecraft-stat-icon">‚ö°</div>
                                        <div class="minecraft-stat-content">
                                            <div class="minecraft-stat-value" id="avgLatency">0ms</div>
                                            <div class="minecraft-stat-label">Avg Latency</div>
                                        </div>
                                    </div>
                                    <div class="minecraft-stat">
                                        <div class="minecraft-stat-icon">üìà</div>
                                        <div class="minecraft-stat-content">
                                            <div class="minecraft-stat-value" id="totalPlayers">0</div>
                                            <div class="minecraft-stat-label">Total Players</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Performance Metrics -->
                        <div class="chart-card">
                            <div class="stat-header">
                                <h3>‚ö° Performance Metrics</h3>
                            </div>
                            <div class="performance-metrics">
                                <div class="metric-item">
                                    <div class="metric-bar">
                                        <div class="metric-fill cpu" style="width: 45%"></div>
                                    </div>
                                    <div class="metric-info">
                                        <span class="metric-label">CPU Usage</span>
                                        <span class="metric-value" id="cpuUsage">45%</span>
                                    </div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-bar">
                                        <div class="metric-fill memory" style="width: 67%"></div>
                                    </div>
                                    <div class="metric-info">
                                        <span class="metric-label">Memory Usage</span>
                                        <span class="metric-value" id="memoryUsage">67%</span>
                                    </div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-bar">
                                        <div class="metric-fill network" style="width: 23%"></div>
                                    </div>
                                    <div class="metric-info">
                                        <span class="metric-label">Network Load</span>
                                        <span class="metric-value" id="networkUsage">23%</span>
                                    </div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-bar">
                                        <div class="metric-fill latency" style="width: 15%"></div>
                                    </div>
                                    <div class="metric-info">
                                        <span class="metric-label">Bot Latency</span>
                                        <span class="metric-value" id="botLatency">15ms</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-panels">
                        <div class="panel">
                            <h3>Recent Activity</h3>
                            <div class="activity-feed">
                                <div class="activity-item">
                                    <span class="activity-time">2 min ago</span>
                                    <span class="activity-text">User banned for spam</span>
                                </div>
                                <div class="activity-item">
                                    <span class="activity-time">5 min ago</span>
                                    <span class="activity-text">Music queue cleared</span>
                                </div>
                                <div class="activity-item">
                                    <span class="activity-time">10 min ago</span>
                                    <span class="activity-text">Auto-moderation blocked spam</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="panel">
                            <h3>Quick Actions</h3>
                            <div class="quick-actions">
                                <button class="action-btn">Clear Music Queue</button>
                                <button class="action-btn">Toggle Auto-Mod</button>
                                <button class="action-btn">Export Logs</button>
                                <button class="action-btn">Restart Bot</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Music Tab -->
                <div class="tab-panel" id="music">
                    <div class="music-controls">
                        <div class="current-track">
                            <div class="track-info">
                                <div class="track-thumbnail">
                                    <img src="https://img.youtube.com/vi/dQw4w9WgXcQ/mqdefault.jpg" alt="Current Track">
                                </div>
                                <div class="track-details">
                                    <h4>Never Gonna Give You Up</h4>
                                    <p>Rick Astley</p>
                                </div>
                            </div>
                            <div class="playback-controls">
                                <button class="control-btn" onclick="musicControl('previous')">‚èÆ</button>
                                <button class="control-btn play-pause" onclick="musicControl('pause')">‚è∏</button>
                                <button class="control-btn" onclick="musicControl('skip')">‚è≠</button>
                                <button class="control-btn" onclick="musicControl('stop')">‚èπ</button>
                            </div>
                        </div>
                        
                        <div class="volume-control">
                            <span>Volume:</span>
                            <input type="range" id="volume-slider" min="0" max="100" value="50">
                            <span id="volume-value">50%</span>
                        </div>
                    </div>
                    
                    <div class="music-sections">
                        <div class="section">
                            <h3>Add to Queue</h3>
                            <div class="add-music">
                                <input type="text" id="music-url" placeholder="YouTube URL or search term" class="music-input">
                                <button onclick="addToQueue()" class="btn-primary">Add to Queue</button>
                            </div>
                        </div>
                        
                        <div class="section">
                            <h3>Current Queue</h3>
                            <div class="queue-list">
                                <div class="queue-item">
                                    <div class="queue-thumbnail">
                                        <img src="https://img.youtube.com/vi/dQw4w9WgXcQ/mqdefault.jpg" alt="Track">
                                    </div>
                                    <div class="queue-info">
                                        <h4>Never Gonna Give You Up</h4>
                                        <p>Rick Astley ‚Ä¢ 3:32</p>
                                    </div>
                                    <button class="remove-btn" onclick="removeFromQueue(1)">‚úï</button>
                                </div>
                                <div class="queue-item">
                                    <div class="queue-thumbnail">
                                        <img src="https://img.youtube.com/vi/y6120QOlsfU/mqdefault.jpg" alt="Track">
                                    </div>
                                    <div class="queue-info">
                                        <h4>Darude - Sandstorm</h4>
                                        <p>Darude ‚Ä¢ 3:53</p>
                                    </div>
                                    <button class="remove-btn" onclick="removeFromQueue(2)">‚úï</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="section">
                            <h3>Saved Playlists</h3>
                            <div class="playlist-grid">
                                <div class="playlist-card">
                                    <h4>Chill Vibes</h4>
                                    <p>15 tracks</p>
                                    <button onclick="loadPlaylist('chill')" class="btn-secondary">Load</button>
                                </div>
                                <div class="playlist-card">
                                    <h4>Gaming Mix</h4>
                                    <p>23 tracks</p>
                                    <button onclick="loadPlaylist('gaming')" class="btn-secondary">Load</button>
                                </div>
                                <div class="playlist-card add-playlist">
                                    <span>+</span>
                                    <p>Create Playlist</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Moderation Tab -->
                <div class="tab-panel" id="moderation">
                    <div class="moderation-sections">
                        <div class="section">
                            <h3>Quick Actions</h3>
                            <div class="mod-actions">
                                <div class="action-group">
                                    <label for="target-user">Target User:</label>
                                    <input type="text" id="target-user" placeholder="User ID or mention" class="mod-input">
                                </div>
                                <div class="action-group">
                                    <label for="mod-reason">Reason:</label>
                                    <input type="text" id="mod-reason" placeholder="Reason for action" class="mod-input">
                                </div>
                                <div class="action-buttons">
                                    <button onclick="moderateUser('warn')" class="btn-warning">Warn</button>
                                    <button onclick="moderateUser('timeout')" class="btn-orange">Timeout</button>
                                    <button onclick="moderateUser('kick')" class="btn-danger">Kick</button>
                                    <button onclick="moderateUser('ban')" class="btn-danger">Ban</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="section">
                            <h3>Auto-Moderation Settings</h3>
                            <div class="automod-settings">
                                <div class="setting-item">
                                    <label class="switch">
                                        <input type="checkbox" id="anti-spam" checked>
                                        <span class="slider"></span>
                                    </label>
                                    <div class="setting-info">
                                        <h4>Anti-Spam Protection</h4>
                                        <p>Automatically detect and remove spam messages</p>
                                    </div>
                                </div>
                                
                                <div class="setting-item">
                                    <label class="switch">
                                        <input type="checkbox" id="bad-word-filter" checked>
                                        <span class="slider"></span>
                                    </label>
                                    <div class="setting-info">
                                        <h4>Bad Word Filter</h4>
                                        <p>Filter inappropriate language</p>
                                    </div>
                                </div>
                                
                                <div class="setting-item">
                                    <label class="switch">
                                        <input type="checkbox" id="anti-raid">
                                        <span class="slider"></span>
                                    </label>
                                    <div class="setting-info">
                                        <h4>Anti-Raid Protection</h4>
                                        <p>Protect against mass joins and raids</p>
                                    </div>
                                </div>
                                
                                <div class="setting-item">
                                    <label class="switch">
                                        <input type="checkbox" id="anti-link">
                                        <span class="slider"></span>
                                    </label>
                                    <div class="setting-info">
                                        <h4>Link Filter</h4>
                                        <p>Block unauthorized links</p>
                                    </div>
                                </div>
                            </div>
                            <button onclick="saveAutomodSettings()" class="btn-primary">Save Settings</button>
                        </div>
                        
                        <div class="section">
                            <h3>Recent Mod Actions</h3>
                            <div class="mod-log">
                                <div class="log-item">
                                    <div class="log-time">2 min ago</div>
                                    <div class="log-action warn">Warning</div>
                                    <div class="log-details">User#1234 warned for spam</div>
                                </div>
                                <div class="log-item">
                                    <div class="log-time">10 min ago</div>
                                    <div class="log-action timeout">Timeout</div>
                                    <div class="log-details">User#5678 timed out for 10 minutes</div>
                                </div>
                                <div class="log-item">
                                    <div class="log-time">1 hour ago</div>
                                    <div class="log-action ban">Ban</div>
                                    <div class="log-details">User#9012 banned for harassment</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Minecraft Tab -->
                <div class="tab-panel" id="minecraft">
                    <div class="minecraft-sections">
                        <div class="section">
                            <h3>Monitored Servers</h3>
                            <div class="server-list">
                                <div class="minecraft-server">
                                    <div class="server-info">
                                        <h4>play.hypixel.net:25565</h4>
                                        <p class="server-status online">Online ‚Ä¢ 47,234/200,000 players</p>
                                    </div>
                                    <div class="server-actions">
                                        <button onclick="forceUpdateServer(1)" class="btn-secondary">Force Update</button>
                                        <button onclick="resetServerCounter(1)" class="btn-warning">Reset Counter</button>
                                        <button onclick="removeServer(1)" class="btn-danger">Remove</button>
                                    </div>
                                </div>
                                
                                <div class="minecraft-server">
                                    <div class="server-info">
                                        <h4>mc.mineplex.com:25565</h4>
                                        <p class="server-status online">Online ‚Ä¢ 8,492/20,000 players</p>
                                    </div>
                                    <div class="server-actions">
                                        <button onclick="forceUpdateServer(2)" class="btn-secondary">Force Update</button>
                                        <button onclick="resetServerCounter(2)" class="btn-warning">Reset Counter</button>
                                        <button onclick="removeServer(2)" class="btn-danger">Remove</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="add-server">
                                <h4>Add New Server</h4>
                                <div class="server-form">
                                    <input type="text" id="server-ip" placeholder="Server IP" class="server-input">
                                    <input type="number" id="server-port" placeholder="Port (default: 25565)" value="25565" class="server-input">
                                    <button onclick="addMinecraftServer()" class="btn-primary">Add Server</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Settings Tab -->
                <div class="tab-panel" id="settings">
                    <div class="settings-sections">
                        <div class="section">
                            <h3>Bot Configuration</h3>
                            <div class="config-grid">
                                <div class="config-item">
                                    <label for="bot-prefix">Command Prefix:</label>
                                    <input type="text" id="bot-prefix" value="!" class="config-input">
                                </div>
                                
                                <div class="config-item">
                                    <label for="default-volume">Default Music Volume:</label>
                                    <input type="range" id="default-volume" min="0" max="100" value="50" class="config-slider">
                                    <span id="default-volume-value">50%</span>
                                </div>
                                
                                <div class="config-item">
                                    <label class="switch">
                                        <input type="checkbox" id="welcome-enabled">
                                        <span class="slider"></span>
                                    </label>
                                    <div class="setting-info">
                                        <label for="welcome-enabled">Welcome Messages</label>
                                        <p>Send welcome messages to new members</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="section">
                            <h3>Bot Avatar</h3>
                            <div class="avatar-section">
                                <div class="current-avatar">
                                    <img id="bot-avatar" src="https://cdn.discordapp.com/avatars/bot/avatar.png" alt="Bot Avatar">
                                </div>
                                <div class="avatar-actions">
                                    <input type="file" id="avatar-upload" accept="image/*" style="display: none;">
                                    <button onclick="document.getElementById('avatar-upload').click()" class="btn-secondary">Upload New Avatar</button>
                                    <button onclick="resetBotAvatar()" class="btn-warning">Reset to Default</button>
                                </div>
                                <p class="avatar-note">Avatar changes apply only to this server</p>
                            </div>
                        </div>
                        
                        <div class="section">
                            <h3>API Tokens</h3>
                            <div class="token-section">
                                <div class="token-item">
                                    <label for="youtube-token">YouTube API Key:</label>
                                    <input type="password" id="youtube-token" placeholder="Enter YouTube API key" class="token-input">
                                </div>
                                
                                <div class="token-item">
                                    <label for="spotify-token">Spotify API Key:</label>
                                    <input type="password" id="spotify-token" placeholder="Enter Spotify API key" class="token-input">
                                </div>
                                
                                <button onclick="saveTokens()" class="btn-primary">Save Tokens</button>
                            </div>
                        </div>
                        
                        <div class="section">
                            <h3>Danger Zone</h3>
                            <div class="danger-actions">
                                <button onclick="exportLogs()" class="btn-warning">Export Bot Logs</button>
                                <button onclick="restartBot()" class="btn-danger">Restart Bot</button>
                                <button onclick="removeBotFromServer()" class="btn-danger">Remove Bot from Server</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Server Modal -->
    <div id="add-server-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAddServerModal()">&times;</span>
            <h2>Add Bot to Server</h2>
            <p>Click the button below to invite the bot to a new server:</p>
            <a href="https://discord.com/oauth2/authorize?client_id=YOUR_BOT_ID&permissions=8&scope=bot" target="_blank" class="btn-primary">
                Invite Bot to Server
            </a>
        </div>
    </div>
    
    <script>
        function selectServer(serverId) {
            console.log('Selecting server:', serverId);
            window.location.href = '/select-server/' + serverId;
        }
        
        function inviteBot() {
            fetch('/api/invite-bot')
                .then(response => response.json())
                .then(data => {
                    if (data.invite_url) {
                        window.open(data.invite_url, '_blank');
                    } else {
                        alert('Discord bot not configured properly');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error getting invite link');
                });
        }
        
        function musicControl(action) {
            fetch(`/api/music/${action}`, { method: 'POST' })
                .then(response => response.json())
                .then(data => console.log(data.message))
                .catch(error => console.error('Error:', error));
        }
        
        function addToQueue() {
            const url = document.getElementById('music-url').value;
            if (!url) return;
            
            fetch('/api/music/add', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({url: url})
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    console.log(data.message);
                    document.getElementById('music-url').value = '';
                    loadMusicQueue(); // Refresh queue
                }
            })
            .catch(error => console.error('Error:', error));
        }
        
        function removeFromQueue(trackId) {
            fetch(`/api/music/remove/${trackId}`, { method: 'DELETE' })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        console.log(data.message);
                        loadMusicQueue(); // Refresh queue
                    }
                })
                .catch(error => console.error('Error:', error));
        }
        
        function loadMusicQueue() {
            fetch('/api/music/queue-list')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        updateQueueDisplay(data.data.queue);
                    }
                })
                .catch(error => console.error('Error loading queue:', error));
        }
        
        function updateQueueDisplay(queue) {
            const queueList = document.querySelector('.queue-list');
            if (!queueList) return;
            
            queueList.innerHTML = queue.map(track => `
                <div class="queue-item">
                    <div class="queue-thumbnail">
                        <img src="${track.thumbnail}" alt="${track.title}">
                    </div>
                    <div class="queue-info">
                        <h4>${track.title}</h4>
                        <p>${track.artist} ‚Ä¢ ${formatDuration(track.duration)}</p>
                    </div>
                    <button class="remove-btn" onclick="removeFromQueue(${track.id})">‚úï</button>
                </div>
            `).join('');
        }
        
        function formatDuration(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
        
        function updateVolumeSlider() {
            const slider = document.getElementById('volume-slider');
            const value = document.getElementById('volume-value');
            
            if (slider && value) {
                slider.addEventListener('input', function() {
                    value.textContent = this.value + '%';
                    
                    fetch('/api/music/volume', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({volume: this.value})
                    })
                    .then(response => response.json())
                    .then(data => console.log(data.message))
                    .catch(error => console.error('Error:', error));
                });
            }
        }
        
        // Moderation functions
        function moderationAction(action, targetUser, reason, duration = null) {
            const payload = { target: targetUser, reason: reason };
            if (duration) payload.duration = duration;
            
            fetch(`/api/moderation/${action}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(payload)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    console.log(data.message);
                    loadModerationLogs(); // Refresh logs
                }
            })
            .catch(error => console.error('Error:', error));
        }
        
        function loadModerationLogs() {
            fetch('/api/moderation/logs')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        updateModerationLogs(data.data);
                    }
                })
                .catch(error => console.error('Error loading logs:', error));
        }
        
        function updateModerationLogs(logs) {
            const logContainer = document.querySelector('.mod-log');
            if (!logContainer) return;
            
            logContainer.innerHTML = logs.map(log => `
                <div class="log-item">
                    <div class="log-time">${formatTimestamp(log.timestamp)}</div>
                    <div class="log-action ${log.action}">${log.action.charAt(0).toUpperCase() + log.action.slice(1)}</div>
                    <div class="log-details">${log.target} ${log.action === 'timeout' ? '('+log.duration+')' : ''} - ${log.reason}</div>
                </div>
            `).join('');
        }
        
        function formatTimestamp(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = Math.floor((now - date) / 60000); // minutes
            
            if (diff < 1) return 'Just now';
            if (diff < 60) return `${diff} min ago`;
            if (diff < 1440) return `${Math.floor(diff / 60)} hours ago`;
            return date.toLocaleDateString();
        }
        
        function saveAutomodSettings() {
            const settings = {
                anti_spam: document.getElementById('anti-spam')?.checked || false,
                anti_raid: document.getElementById('anti-raid')?.checked || false,
                link_filter: document.getElementById('anti-link')?.checked || false
            };
            
            fetch('/api/moderation/automod-settings', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(settings)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    console.log(data.message);
                    alert('Auto-moderation settings saved!');
                }
            })
            .catch(error => console.error('Error:', error));
        }
        
        // Minecraft functions
        function addMinecraftServer() {
            const host = document.getElementById('server-ip')?.value;
            const port = document.getElementById('server-port')?.value || 25565;
            
            if (!host) return;
            
            fetch('/api/minecraft/add-server', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({host, port: parseInt(port)})
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    console.log(data.message);
                    document.getElementById('server-ip').value = '';
                    document.getElementById('server-port').value = '25565';
                    loadMinecraftServers(); // Refresh servers
                }
            })
            .catch(error => console.error('Error:', error));
        }
        
        function forceUpdateServer(serverId) {
            fetch(`/api/minecraft/force-update/${serverId}`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        console.log(data.message);
                        loadMinecraftServers(); // Refresh servers
                    }
                })
                .catch(error => console.error('Error:', error));
        }
        
        function resetServerCounter(serverId) {
            if (confirm('Are you sure you want to reset the counter for this server?')) {
                console.log(`Resetting counter for server ${serverId}`);
                // This would call an API endpoint when implemented
            }
        }
        
        function removeServer(serverId) {
            if (confirm('Are you sure you want to remove this server from monitoring?')) {
                fetch(`/api/minecraft/remove-server/${serverId}`, { method: 'DELETE' })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            console.log(data.message);
                            loadMinecraftServers(); // Refresh servers
                        }
                    })
                    .catch(error => console.error('Error:', error));
            }
        }
        
        function loadMinecraftServers() {
            fetch('/api/minecraft/servers')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        updateMinecraftServers(data.data);
                    }
                })
                .catch(error => console.error('Error loading minecraft servers:', error));
        }
        
        function updateMinecraftServers(servers) {
            const serverList = document.querySelector('.server-list');
            if (!serverList) return;
            
            serverList.innerHTML = servers.map(server => `
                <div class="minecraft-server">
                    <div class="server-info">
                        <h4>${server.host}:${server.port}</h4>
                        <p class="server-status ${server.status}">${server.status.charAt(0).toUpperCase() + server.status.slice(1)} ‚Ä¢ ${server.players.online}/${server.players.max} players</p>
                    </div>
                    <div class="server-actions">
                        <button onclick="forceUpdateServer(${server.id})" class="btn-secondary">Force Update</button>
                        <button onclick="resetServerCounter(${server.id})" class="btn-warning">Reset Counter</button>
                        <button onclick="removeServer(${server.id})" class="btn-danger">Remove</button>
                    </div>
                </div>
            `).join('');
        }
        
        // Settings functions
        function loadBotSettings() {
            fetch('/api/settings/bot-config')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        const config = data.data;
                        
                        const prefixInput = document.getElementById('bot-prefix');
                        const volumeInput = document.getElementById('default-volume');
                        const volumeValue = document.getElementById('default-volume-value');
                        const welcomeToggle = document.getElementById('welcome-enabled');
                        
                        if (prefixInput) prefixInput.value = config.prefix;
                        if (volumeInput) {
                            volumeInput.value = config.default_volume;
                            if (volumeValue) volumeValue.textContent = config.default_volume + '%';
                        }
                        if (welcomeToggle) welcomeToggle.checked = config.welcome_enabled;
                    }
                })
                .catch(error => console.error('Error loading settings:', error));
        }
        
        function saveBotSettings() {
            const settings = {
                prefix: document.getElementById('bot-prefix')?.value || '!',
                default_volume: document.getElementById('default-volume')?.value || 50,
                welcome_enabled: document.getElementById('welcome-enabled')?.checked || false
            };
            
            fetch('/api/settings/bot-config', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(settings)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    console.log(data.message);
                    alert('Bot settings saved!');
                }
            })
            .catch(error => console.error('Error:', error));
        }
        
        function exportLogs() {
            fetch('/api/settings/export-logs')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        console.log(data.message);
                        alert('Logs exported successfully! Check downloads.');
                    }
                })
                .catch(error => console.error('Error:', error));
        }
        
        function restartBot() {
            if (confirm('Are you sure you want to restart the bot? This may cause temporary downtime.')) {
                alert('Bot restart initiated. This is a demo - no actual restart performed.');
            }
        }
        
        function removeBotFromServer() {
            if (confirm('Are you sure you want to remove the bot from this server? This action cannot be undone.')) {
                alert('This is a demo - actual bot removal would require server admin permissions.');
            }
        }
        
        // Load data when tabs are switched
        function initializeTabData() {
            // Set up tab switching with data loading
            const tabBtns = document.querySelectorAll('.tab-btn');
            
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // Load data based on active tab
                    switch(targetTab) {
                        case 'music':
                            loadMusicQueue();
                            updateVolumeSlider();
                            break;
                        case 'moderation':
                            loadModerationLogs();
                            break;
                        case 'minecraft':
                            loadMinecraftServers();
                            break;
                        case 'settings':
                            loadBotSettings();
                            break;
                    }
                });
            });
        }
        
        // Tab switching functionality
        document.addEventListener('DOMContentLoaded', function() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabPanels = document.querySelectorAll('.tab-panel');
            
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // Remove active class from all tabs and panels
                    tabBtns.forEach(b => b.classList.remove('active'));
                    tabPanels.forEach(p => p.classList.remove('active'));
                    
                    // Add active class to clicked tab and corresponding panel
                    this.classList.add('active');
                    document.getElementById(targetTab).classList.add('active');
                });
            });
        });
        
        // Enhanced Dashboard Functionality for Server Selection
        let gaugeCharts = {};
        let activityChart, commandChart, minecraftChart;
        
        // Initialize enhanced dashboard when DOM loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeEnhancedDashboard();
            initializeTabData();
            loadDashboardData();
            
            // Auto-refresh every 30 seconds
            setInterval(loadDashboardData, 30000);
        });
        
        function initializeEnhancedDashboard() {
            // Initialize gauge charts
            initializeGauges();
            
            // Initialize line charts
            initializeCharts();
            
            console.log('Enhanced dashboard initialized');
        }
        
        function initializeGauges() {
            const gaugeConfigs = [
                { id: 'minecraftCounterGauge', color: '#5865f2', max: 1000 },
                { id: 'botUsageGauge', color: '#57f287', max: 500 },
                { id: 'uptimeGauge', color: '#fee75c', max: 100 },
                { id: 'playersGauge', color: '#ed4245', max: 100 }
            ];
            
            gaugeConfigs.forEach(config => {
                const canvas = document.getElementById(config.id);
                if (canvas) {
                    gaugeCharts[config.id] = createGaugeChart(canvas, config);
                }
            });
        }
        
        function createGaugeChart(canvas, config) {
            const ctx = canvas.getContext('2d');
            
            return new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [0, config.max],
                        backgroundColor: [config.color, '#2c2f33'],
                        borderWidth: 0,
                        cutout: '75%'
                    }]
                },
                options: {
                    responsive: false,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    },
                    rotation: -90,
                    circumference: 180
                }
            });
        }
        
        function initializeCharts() {
            // Command Usage Pie Chart
            const commandCtx = document.getElementById('commandUsageChart');
            if (commandCtx) {
                commandChart = new Chart(commandCtx, {
                    type: 'pie',
                    data: {
                        labels: [],
                        datasets: [{
                            data: [],
                            backgroundColor: ['#5865f2', '#57f287', '#fee75c', '#ed4245', '#eb459e', '#00d166'],
                            borderWidth: 2,
                            borderColor: '#1e1e2e'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { color: '#ffffff', font: { size: 12 } }
                            }
                        }
                    }
                });
            }
            
            // Activity Timeline Chart
            const activityCtx = document.getElementById('activityTimelineChart');
            if (activityCtx) {
                activityChart = new Chart(activityCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Commands',
                            data: [],
                            borderColor: '#5865f2',
                            backgroundColor: 'rgba(88, 101, 242, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: '#36393f' },
                                ticks: { color: '#8e9297' }
                            },
                            x: {
                                grid: { color: '#36393f' },
                                ticks: { color: '#8e9297' }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: { color: '#ffffff' }
                            }
                        }
                    }
                });
            }
            
            // Minecraft Server Chart
            const minecraftCtx = document.getElementById('minecraftHistoryChart');
            if (minecraftCtx) {
                minecraftChart = new Chart(minecraftCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: []
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: '#36393f' },
                                ticks: { color: '#8e9297' }
                            },
                            x: {
                                grid: { color: '#36393f' },
                                ticks: { color: '#8e9297' }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: { color: '#ffffff' }
                            }
                        }
                    }
                });
            }
        }
        
        async function loadDashboardData() {
            try {
                console.log('Loading enhanced dashboard data...');
                
                // Load main stats
                const statsResponse = await fetch('/api/stats');
                const statsData = await statsResponse.json();
                
                if (statsData.status === 'success') {
                    updateQuickStats(statsData.data);
                    updateGauges(statsData.data);
                    updateCommandChart(statsData.data);
                    updateMinecraftStats(statsData.data);
                }
                
                // Load minecraft history data
                const historyResponse = await fetch('/api/minecraft-history');
                const historyData = await historyResponse.json();
                
                if (historyData.status === 'success') {
                    updateMinecraftChart(historyData.data);
                }
                
                // Generate activity timeline data
                updateActivityChart();
                
                console.log('Dashboard data loaded successfully');
                
            } catch (error) {
                console.error('Error loading enhanced dashboard data:', error);
            }
        }
        
        function updateQuickStats(data) {
            document.getElementById('quickTotalServers').textContent = data.guilds_joined || 0;
            document.getElementById('quickTotalUsers').textContent = (data.guilds_joined * 50) || 0;
            document.getElementById('quickCommandsToday').textContent = data.total_commands_used || 0;
        }
        
        function updateGauges(data) {
            // Update Minecraft Counter Gauge
            if (gaugeCharts.minecraftCounterGauge && data.minecraft_counter_updates) {
                const value = data.minecraft_counter_updates;
                const max = 1000;
                const percentage = Math.min((value / max) * 100, 100);
                
                gaugeCharts.minecraftCounterGauge.data.datasets[0].data = [percentage, 100 - percentage];
                gaugeCharts.minecraftCounterGauge.update();
                
                document.getElementById('minecraftCounterValue').textContent = value;
                document.getElementById('minecraftToday').textContent = Math.floor(value * 0.3);
                document.getElementById('minecraftPeak').textContent = Math.floor(value * 0.1);
            }
            
            // Update Bot Usage Gauge
            if (gaugeCharts.botUsageGauge && data.total_commands_used) {
                const value = data.total_commands_used;
                const max = 500;
                const percentage = Math.min((value / max) * 100, 100);
                
                gaugeCharts.botUsageGauge.data.datasets[0].data = [percentage, 100 - percentage];
                gaugeCharts.botUsageGauge.update();
                
                document.getElementById('botUsageValue').textContent = value;
                document.getElementById('commandsHour').textContent = Math.floor(value * 0.05);
            }
            
            // Update Uptime Gauge
            if (gaugeCharts.uptimeGauge && data.uptime) {
                const percentage = data.uptime.uptime_percentage || 99.9;
                
                gaugeCharts.uptimeGauge.data.datasets[0].data = [percentage, 100 - percentage];
                gaugeCharts.uptimeGauge.update();
                
                document.getElementById('uptimeValue').textContent = percentage.toFixed(1) + '%';
                document.getElementById('sessionTime').textContent = data.uptime.formatted_current || '0h';
            }
            
            // Update Players Gauge
            if (gaugeCharts.playersGauge && data.minecraft_stats) {
                const value = data.minecraft_stats.max_players_seen || 0;
                const max = 100;
                const percentage = Math.min((value / max) * 100, 100);
                
                gaugeCharts.playersGauge.data.datasets[0].data = [percentage, 100 - percentage];
                gaugeCharts.playersGauge.update();
                
                document.getElementById('playersValue').textContent = value;
                document.getElementById('peakPlayers').textContent = Math.floor(value * 1.2);
                document.getElementById('avgPlayers').textContent = Math.floor(value * 0.7);
            }
        }
        
        function updateCommandChart(data) {
            if (commandChart && data.command_breakdown) {
                const commands = Object.keys(data.command_breakdown);
                const counts = Object.values(data.command_breakdown);
                
                commandChart.data.labels = commands;
                commandChart.data.datasets[0].data = counts;
                commandChart.update();
            }
        }
        
        function updateActivityChart() {
            if (activityChart) {
                // Generate 24 hours of sample activity data
                const labels = [];
                const data = [];
                
                for (let i = 23; i >= 0; i--) {
                    const hour = new Date();
                    hour.setHours(hour.getHours() - i);
                    labels.push(hour.getHours() + ':00');
                    data.push(Math.floor(Math.random() * 50) + 10);
                }
                
                activityChart.data.labels = labels;
                activityChart.data.datasets[0].data = data;
                activityChart.update();
            }
        }
        
        function updateMinecraftChart(data) {
            if (minecraftChart && data.times && data.servers) {
                minecraftChart.data.labels = data.times;
                minecraftChart.data.datasets = data.servers.map(server => ({
                    label: server.name,
                    data: server.data,
                    borderColor: server.color,
                    backgroundColor: server.color + '20',
                    tension: 0.4
                }));
                minecraftChart.update();
            }
        }
        
        function updateMinecraftStats(data) {
            if (data.minecraft_stats) {
                document.getElementById('totalServers').textContent = data.minecraft_stats.servers_monitored || 0;
                document.getElementById('onlineServers').textContent = data.minecraft_stats.servers_monitored || 0;
                document.getElementById('avgLatency').textContent = data.minecraft_stats.avg_response_time + 'ms' || '0ms';
                document.getElementById('totalPlayers').textContent = data.minecraft_stats.max_players_seen || 0;
            }
        }
        
        // Chart control functions
        function updateCommandChart() {
            loadDashboardData();
        }
        
        function setActivityView(view) {
            document.querySelectorAll('.chart-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updateActivityChart();
        }
        
        function refreshMinecraftData() {
            loadDashboardData();
        }
        
        function exportMinecraftData() {
            alert('Export functionality would be implemented here');
        }
    </script>
</body>
</html>